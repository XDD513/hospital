# 中医体质辨识与医院预约系统 - 接口设计文档

> **文档版本**: v1.0.0  
> **创建日期**: 2025-01-XX  
> **最后更新**: 2025-01-XX  
> **说明**: 项目前后端分离，统一以 RESTful 风格设计接口，本文档对核心模块的请求方式、URL、主要参数和返回结果进行说明。所有接口默认返回统一结构：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1730000000000
}
```

---

## 1. 认证与用户中心

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 登录 | POST | `/api/auth/login` | 请求体 `LoginRequest`（username、password、roleType），返回 `LoginResponse`（token、用户信息） |
| 注册 | POST | `/api/auth/register` | 请求体 `RegisterRequest`，默认注册患者角色 |
| 退出登录 | POST | `/api/auth/logout` | Header 携带 `Authorization: Bearer <token>` |
| 获取个人信息 | GET | `/api/user/profile` | 使用 JWT 中的 userId 自动识别 |
| 更新个人信息 | PUT | `/api/user/profile` | `UpdateUserInfoRequest`（昵称、性别、手机号、头像等） |
| 修改密码 | PUT | `/api/user/password` | `ChangePasswordRequest`（newPassword、confirmPassword） |
| 获取用户设置 | GET | `/api/user/settings` | 返回 `UserSettingsResponse`（消息提醒、短信提醒等） |
| 更新用户设置 | PUT | `/api/user/settings` | `UserSettingsRequest` |
| 患者预约统计 | GET | `/api/user/appointment-stats` | 返回累计预约数、待就诊数等 |

---

## 2. 科室、医生、预约

| 功能 | Method | URL | 主要参数 |
|------|--------|-----|----------|
| 科室列表 | GET | `/api/department/list` | `name`（可选） |
| 医生列表 | GET | `/api/doctor/list` | `deptId`, `keyword`, `pageNum`, `pageSize` |
| 医生详情 | GET | `/api/doctor/{id}` | path `id` |
| 排班查询 | GET | `/api/schedule/list` | `doctorId`, `startDate`, `endDate` |
| 创建预约 | POST | `/api/appointment` | `AppointmentCreateRequest`（doctorId、scheduleId、timeSlot） |
| 预约列表（患者） | GET | `/api/appointment/patient/list` | `status`, `pageNum`, `pageSize` |
| 预约列表（医生） | GET | `/api/appointment/doctor/list` | `status`, `pageNum`, `pageSize` |
| 取消预约 | PUT | `/api/appointment/{id}/cancel` | path `id`，请求参数 `reason`（可选） |
| 接诊完成 | PUT | `/api/consultation/{appointmentId}/complete` | body 包含诊断、医嘱、处方信息 |
| 接诊记录列表 | GET | `/api/consultation/records` | `doctorId` 或 `patientId` |

约束：创建/取消预约需登录患者身份，医生端接诊接口需医生角色，管理员拥有全部权限。

---

## 3. 中医体质辨识

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 获取体质类型 | GET | `/api/constitution/types` | 返回 9 种体质基础信息 |
| 获取体质详情 | GET | `/api/constitution/type/{code}` | `code` 如 `QIXU` |
| 获取问卷 | GET | `/api/constitution/questionnaire` | 包括题目与选项 |
| 提交测试 | POST | `/api/constitution/test/submit` | `ConstitutionTestSubmitRequest`（answers 数组） |
| 测试历史 | GET | `/api/constitution/test/history` | `pageNum`, `pageSize` |
| 测试报告 | GET | `/api/constitution/test/report/{id}` | path `id` |
| 最新测试 | GET | `/api/constitution/test/latest` | 返回最近一次结果 |

返回结果包含主次体质、分数、分析与建议。

---

## 4. 健康管理

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 获取健康档案 | GET | `/api/health/profile` | 需患者登录 |
| 更新健康档案 | PUT | `/api/health/profile` | `HealthProfileRequest` |
| 健康打卡 | POST | `/api/health/checkin` | 体重、睡眠、运动、心情等 |
| 打卡记录 | GET | `/api/health/checkin/history` | `startDate`, `endDate` |
| 健康统计 | GET | `/api/health/statistics` | `userId`, `startDate`, `endDate` |

健康趋势接口返回 weightTrend、sleepTrend、exerciseTrend、moodDistribution 用于 ECharts 展示。

---

## 5. 药膳推荐

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 食谱列表 | GET | `/api/recipe/list` | `constitutionType`, `season`, `effect`, `keyword`, `pageNum`, `pageSize` |
| 食谱详情 | GET | `/api/recipe/{id}` | path `id` |
| 推荐食谱 | GET | `/api/recipe/recommend` | 基于体质自动推荐 |
| 搜索食谱 | GET | `/api/recipe/search` | `keyword`, `pageNum`, `pageSize` |
| 收藏食谱 | POST | `/api/recipe/favorite/{id}` | 需患者登录 |
| 取消收藏 | DELETE | `/api/recipe/favorite/{id}` | 需患者登录 |
| 收藏列表 | GET | `/api/recipe/favorites` | `pageNum`, `pageSize` |
| 热门/季节食谱 | GET | `/api/recipe/popular`, `/api/recipe/seasonal` | limit 参数 |

---

## 6. 穴位指导

| 功能 | Method | URL |
|------|--------|-----|
| 穴位列表 | GET | `/api/acupoint/list`（支持 `keyword`, `meridian`, `effect`） |
| 穴位详情 | GET | `/api/acupoint/{id}` |
| 搜索穴位 | GET | `/api/acupoint/search` |
| 推荐穴位 | GET | `/api/acupoint/recommend` |
| 组合方案列表 | GET | `/api/acupoint/combination/list` |
| 方案详情 | GET | `/api/acupoint/combination/{id}` |

---

## 7. 养生知识社区

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 文章列表 | GET | `/api/article/list` | `category`, `constitutionType`, `isFeatured`, `pageNum`, `pageSize` |
| 文章详情 | GET | `/api/article/{id}` | path `id` |
| 搜索文章 | GET | `/api/article/search` | `keyword` |
| 发布文章 | POST | `/api/article/publish` | body `HealthArticle` |
| 更新文章 | PUT | `/api/article/{id}` | path `id` |
| 删除文章 | DELETE | `/api/article/{id}?userId=` | 需作者或管理员 |
| 点赞/取消 | POST `/api/article/like/{id}`, DELETE `/api/article/like/{id}` | `userId` |
| 收藏/取消 | POST `/api/article/favorite/{id}`, DELETE `/api/article/favorite/{id}` | `userId` |
| 收藏列表 | GET | `/api/article/favorites` | `userId`, `pageNum`, `pageSize` |
| 我的文章 | GET | `/api/article/my` | `userId` |
| 推荐/热门 | GET | `/api/article/recommended`, `/api/article/popular` | limit |
| 点赞/收藏状态 | GET | `/api/article/like/status/{id}`, `/api/article/favorite/status/{id}` | `userId` |

评论相关：
- 添加评论：`POST /api/article/{id}/comment`
- 删除评论：`DELETE /api/comment/{commentId}`
- 评论列表：`GET /api/comment/list/{articleId}`
- 点赞评论：`POST /api/comment/{commentId}/like`

---

## 8. 搜索与热门词

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 记录搜索关键词 | POST | `/api/search/record` | 参数 `keyword` |
| 获取热门搜索词 | GET | `/api/search/hot-keywords` | `limit` |
| 全局搜索 | GET | `/api/search/global`（预留） | 可扩展统一结果 |

---

## 9. 消息通知与对话

| 功能 | Method | URL | 说明 |
|------|--------|-----|------|
| 会话列表 | GET | `/api/conversation/list` | 根据当前角色返回 |
| 创建会话 | POST | `/api/conversation/create` | 支持医生/患者/管理员发起 |
| 发送消息 | POST | `/api/conversation/{id}/message` | 支持文本、图片、文件 |
| WebSocket 地址 | `ws://<host>/ws/message` | STOMP 协议 |
| 通知分页 | GET | `/api/patient/notifications` | `page`, `pageSize`, `readStatus`, `type` |
| 未读通知 | GET | `/api/patient/notifications/unread` | `limit` |
| 标记已读 | PUT | `/api/patient/notifications/{id}/read` | path `id` |
| 批量已读 | PUT | `/api/patient/notifications/read-all` | body `List<Long>` |

通知类型示例：`APPOINTMENT_CREATED`, `APPOINTMENT_CANCELLED`, `CONSULTATION_COMPLETED`, `DOCTOR_REPLY`.

---

## 10. 数据统计

| 端 | 功能 | Method | URL |
|----|------|--------|-----|
| 管理员 | 控制台统计 | GET | `/api/statistics/admin` |
| 管理员 | 月度统计 | GET | `/api/statistics/monthly` |
| 管理员 | 医生工作量 | GET | `/api/statistics/doctor` |
| 管理员 | 科室预约热力 | GET | `/api/statistics/department` |
| 医生 | 今日排班/预约 | GET | `/api/doctor/dashboard` |
| 患者 | 健康趋势 | GET | `/api/health/statistics` |

---

## 11. 通用约定

1. **认证**：除登录、注册、公开内容外，所有接口需在 Header 中携带 `Authorization: Bearer <token>`。
2. **分页**：统一使用 `pageNum`（默认 1）、`pageSize`（默认 10/20）参数，返回值采用 MyBatis-Plus `IPage` 结构。
3. **时间格式**：默认 ISO 8601（`yyyy-MM-dd HH:mm:ss`），前端使用 dayjs 解析。
4. **错误码**：见 `ResultCode`，常见如 `400` 参数错误、`401` 未登录、`403` 无权限、`404` 数据不存在、`500` 系统异常。
5. **文件上传**：通过 `/api/oss/policy` 获取临时签名，前端直传 OSS，成功后回传 URL 至业务接口。

---

**文档结束**

