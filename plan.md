# 项目总体规划

## 现状与问题概述
- 后端：Spring Boot + MyBatis-Plus，Redis、RabbitMQ、WebSocket 已集成，统计模块已有缓存；对象映射未使用 MapStruct；部分服务包含重复的参数解析与缓存键拼接逻辑；统一异常与返回体已具备。
- 前端：Vue3 + Vite + Element Plus，路由已懒加载；首页 `views/patient/Home.vue` 功能完善但同步发起多次请求、ECharts库同步引入、模块内聚度不足；Vitest 与 Playwright 已配置但覆盖率有限。
- 文档：`docs/系统架构设计.md` 已存在，可在此基础上完善；首页缺少独立的设计与实现方案文档。

## 目标
- 架构稳健：明确分层与跨横切关注点（缓存、日志、限流、异常）的一致策略。
- 代码质量：减少重复、增强内聚与可测试性，建立规范与流程。
- 性能优化：后端查询与缓存策略优化；前端首屏与交互性能优化。
- 首页方案：响应式、模块化、流畅交互与动画、良好加载与基础 SEO。
- 质量保障：单测、集成测与端到端测试覆盖关键路径。

# 架构与代码优化方案

## 方案A：渐进式优化（推荐）
- 在现有结构上消除热点与重复，提炼通用组件/工具，逐步引入 MapStruct、统一缓存键与过期策略，保持迭代风险低。

## 方案B：部分重构与模块抽象
- 引入领域对象与 DTO 映射层、统一 `CacheKeyBuilder`、提炼 `Result` + 错误码扩展、拆分长服务方法；对首页提炼独立组件库并建立演示页。风险与变更较大。

# 详细实施清单

## 后端优化
1. DTO 映射层落地：引入 MapStruct 映射接口，替代手写拷贝（示例：用户、预约、统计 DTO）。
2. 缓存策略统一：抽象 `CacheKeyBuilder` 与 `CacheTtlPolicy`，统一键空间与过期时间；复用到统计与推荐等服务。
3. 数据访问优化：分页与选择列（避免不必要的 `SELECT *`），必要索引检查与补充（预约、评价、打卡表）。
4. 统一参数校验：基于 `spring-boot-starter-validation` 在 controller 层完善 `@Valid` 与校验消息。
5. 异常与日志：扩展 `ResultCode`，在 `GlobalExceptionHandler` 增加业务场景分类与可观测日志字段（traceId）。
6. 单元与集成测试：补齐核心服务（预约、统计、限流、加密处理）的单测，并以 H2 + Spring Boot Test 做集成验证。

## 前端优化
1. 首页组件化拆分：`HeroBanner`、`StatGrid`、`ConstitutionPanel`、`HealthTrend`、`RecipeList`、`ArticleTimeline`；建立统一样式变量与主题。
2. 异步加载与并行：将首页数据请求并行化（`Promise.allSettled`）；ECharts 做按需动态导入（仅可见时加载）。
3. 交互与动画：使用 `IntersectionObserver` + CSS Transition 实现进场动画；按钮与卡片 hover 动画统一。
4. 性能与可用性：Skeleton/Empty 占位、图片懒加载与合理尺寸、首屏关键 CSS 内联、路由 meta 标题完善；基础 SEO（`index.html` 结构化数据与关键 meta）。
5. 测试：Vitest 组件测试（渲染、交互、边界），Playwright 端到端（登录后首页模块可见性与跳转）。

## 规范与流程
1. 代码规范：后端 Checkstyle/Spotless，前端 ESLint + Prettier + Stylelint；提交前校验。
2. Git 流程：约定分支规范、Commit message、PR 模板与自动检查（CI 可后续加入）。
3. 文档：统一放置在 `docs/`，避免重复文件；架构与首页方案形成版本化文档。

# 首页制作方案

## 信息架构与版块
- 主视觉展示区（Hero）：系统名称、欢迎语、行动按钮（体质历史、药膳推荐）。
- 核心功能入口（StatGrid）：体质测试次数、收藏药膳、发布文章、连续打卡，点击跳转。
- 特色内容推荐：推荐药膳（含 AI 推荐理由）；精选养生文章。
- 用户引导区域：体质概览与建议、健康趋势图表、更多入口与指引。

## 响应式与布局
- 容器最大宽度 `~1400px`，断点 `≥1200/≥992/≥768/<768`；栅格使用 Element Plus `el-row/el-col`。
- 移动端：隐藏右侧大图、按钮纵向堆叠、卡片间距与字号调整。

## 交互与动画
- 进场动画：模块进入视口后淡入与上移（统一 200–300ms）。
- 图表加载：延迟加载 + 渐显；模块切换保持状态。
- 卡片 hover：阴影与轻微抬升统一规范。

## 性能与 SEO
- 并行请求、按需加载 ECharts；图片懒加载与预设占位图；减少重排。
- `index.html` 增加基本 meta（keywords、description）、Open Graph、JSON-LD 结构化数据（组织与站点）。
- 路由 `meta.title` 已用作文档标题，补充系统名称拼接。

## 组件库与样式规范
- 组件前缀 `Hsp*`，如 `HspHeroBanner` 等；样式变量集中在 `styles/*`，颜色与间距统一。
- 动画与阴影变量化（如 `--elevation-1/2/3`）。

# 测试与验收
- 单元测试：覆盖率目标后端 ≥60%，前端组件关键逻辑 ≥70%。
- 集成测试：用户注册/登录/预约/统计接口串联验证。
- 端到端测试：登录后首页各模块渲染与跳转；移动端视口断点验证。

# 文档与交付
- 更新 `docs/系统架构设计.md`：补充分层图、缓存策略、错误码规范。
- 新增 `docs/首页设计与实现方案.md`：信息架构、交互稿、组件规范、性能与 SEO 指南。
- 输出《性能优化报告》：改动说明、基准与结果、后续建议。

---
请确认是否按“方案A 渐进式优化”推进；确认后将按上述计划实施并分阶段提交代码与文档。